--- 
title: "Basics of Health Intelligent Data Analysis"
author: "Bruno Lima, Cátia Redondo"
date: "`r Sys.Date()`"
site: bookdown::bookdown_site
documentclass: book
bibliography: [book.bib, packages.bib]
biblio-style: apalike
link-citations: no
description: "This is a work on ANALYZE using the bookdown package to write a book. The output format for this example is bookdown::gitbook."
---


#  {-}

```{r include=FALSE}
# automatically create a bib database for R packages
knitr::write_bib(c(
  .packages(), 'bookdown', 'knitr', 'rmarkdown'
), 'packages.bib')
```


```{r echo=FALSE}
knitr::include_graphics("images/heads.png")
```

<img src="images/logoFMUP.png" alt="logotipo FMUP" style="width:100px;height:40px;" align="right">

# Preface {-}

This is a _book_ written in **Markdown** through *RStudio*.

The **bookdown** package [@xie2015] can be installed from CRAN or Github:

```{r eval=FALSE}
install.packages("bookdown")
# or the development version
# devtools::install_github("rstudio/bookdown")
```

To compile this example to PDF, you need XeLaTeX. You are recommended to install TinyTeX (which includes XeLaTeX): <https://yihui.name/tinytex/>.

In this _book_, we will present our results for the work we made on the subject of **Basics of Health Intelligent Data Analysis** from the **HEADS** PhD programme. 

An exhaustive explanation using the **bookdown** package [@R-bookdown] can be found at <a href="https://bookdown.org/yihui/bookdown/">bookdown: Authoring Books and Technical Documents with R Markdown</a> and this is only a sample book, which was built on top of R Markdown and **knitr**

This _book_ is publish through NETLIFY as described by <a href="https://cerebralmastication.com/2019/05/11/publishing-bookdown-to-netlify-automagically/">C.M.</a>


<img src="images/logoFMUP.png" alt="logotipo FMUP" style="width:100px;height:40px;" align="right">

<!--chapter:end:index.Rmd-->

# Introduction {#intro}

Obstructive sleep apnea (OSA) is a potentially serious sleep disorder. This is a common disorder characterized by repetitive episodes of nocturnal breathing cessation due to upper airway collaps. The obstructive events (apnoeas or hypopnoeas) cause a progressive asphyxia that increasingly stimulates breathing efforts against the collapsed airway. 

The aetiology of OSA is multifactorial, consisting of a complex interplay between anatomic, neuromuscular factors and an underlying genetic predisposition toward the disease. Risk factors include: snoring, male gender, middle age, menopause in women, obesity, narrowed airway, hypertension, chronic nasal congestion, smoking, diabetes, family history of sleep apnea, asthma, large neck circumference, enlarged tonsils/adenoids and low-lying soft palate.

Complications from recurrent OSA may include: daytime fatigue and sleepiness, cardiovascular problems, complications with medications and surgery, eye problems, or sleep-deprived partners. Also, people with obstructive sleep apnea may also complain of memory problems, morning headaches, mood swings or feelings of depression, and a need to urinate frequently at night (nocturia).

In this exercise the primary objective is to identify predictive factors for sleep apnea in OSA patients using multivariable logistic regression models. We aim to identify risk factors for OSA.

<img src="images/logoFMUP.png" alt="logotipo FMUP" style="width:100px;height:40px;" align="right">

<!--chapter:end:10-intro.Rmd-->


# Methods {#method}

Placeholder



<!--chapter:end:20-method.Rmd-->

# Results {#result}

```{r setupR, include=FALSE}
knitr::opts_chunk$set(echo = F, message = F, warning = F, error = F)

# source("_dados.R")
```

In this study we analysed a total of `r dim(dados)[1]` subjects, from those `r with(dados, table(Gender))[2]` (`r round(with(dados, table(Gender))[2]/dim(dados)[1] * 100,2)`%) are male, and `r with(dados,table(OSA))[2]` (`r round(with(dados,table(OSA))[2] / dim(dados)[1] * 100, 2)`%) have OSA.

When we analysed missing data (Figure \@ref(fig:missis1)) we do not found any variable with an excessive number of missing values. 

```{r missis1, fig.cap='Missing values for each variable 1/2', fig.align='center'}
theme_set(theme_classic())

missmap(dados[,1:20]) 

```

```{r missis2, fig.cap='Missing values for each variable 2/2', fig.align='center'}
theme_set(theme_classic())

missmap(dados[,21:40]) 
```


<img src="images/logoFMUP.png" alt="logotipo FMUP" style="width:100px;height:40px;" align="right">

<!--chapter:end:30-result.Rmd-->



## Descriptive analysis {#results1}

<!--chapter:end:31-results1.Rmd-->



## Univariate analysis {#results2}

<!--chapter:end:32-results2.Rmd-->



## First Model {#results3}
### stepwise "both"
### Model's formula
### summary statistics
### Hosmer-Lemeshow Test
### Pseudo R^2
### Accuracy

<!--chapter:end:33-results3.Rmd-->



## New Model {#results4}
### New model's formula
### Summary statistics
### Hosmer-Lemeshow Test
### Pseudo R^2
### Accuracy
### ROC
### VIF
### Leave one out Cross-validation

<!--chapter:end:34-results4.Rmd-->

# Discussion {#discus}

Ideally, the proportion of events (with) and non-events (without) in the Y variable (OSA) should approximately be the same. In this analysis we have 2/3 of patients with OSA and only 1/3 without OSA. So we could sample the observations in approximately equal proportions to get better models as a sensitivity analysis, but we didn't do it.

In this case we use p-values to select the variables to use in our model but if we had used a very large dataset we could instead find the information value of variables to get an idea of how valuable they are in explaining the dependent variable (OSA).
We couldn't replicate this traditional approach in the selection of variables to define a predictive mode when we work with “too large” datasets because we will have statistical significant results for all the variables in the univariate analysis.


<img src="images/logoFMUP.png" alt="logotipo FMUP" style="width:100px;height:40px;" align="right">


<!--chapter:end:40-discuss.Rmd-->

# Final Words

We have finished a nice book.



<img src="images/logoFMUP.png" alt="logotipo FMUP" style="width:100px;height:40px;" align="right">

<!--chapter:end:50-summary.Rmd-->

`r if (knitr::is_html_output()) '
# References {-}
'`


<!--chapter:end:60-references.Rmd-->

